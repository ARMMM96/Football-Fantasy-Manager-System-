generator client {
      provider   = "prisma-client"
      output     = "./generated/prisma"
      engineType = "library"
}

datasource db {
      provider = "postgresql"
}

model Role {
      id          String   @id @default(uuid())
      code        String   @unique
      name        String
      permissions Json?
      users       User[]
      createdAt   DateTime @default(now()) @map("created_at")
      updatedAt   DateTime @updatedAt @map("updated_at")

      @@map("roles")
}

model User {
      id              String     @id @default(uuid())
      email           String     @unique
      passwordHash    String     @map("password_hash")
      isEmailVerified Boolean    @default(false) @map("is_email_verified")
      isActive        Boolean    @default(true) @map("is_active")
      role            Role       @relation(fields: [roleId], references: [id])
      roleId          String     @map("role_id")
      team            Team?
      sessions        Session[]
      auditLogs       AuditLog[]
      lastLoginAt     DateTime?  @map("last_login_at")
      createdAt       DateTime   @default(now()) @map("created_at")
      updatedAt       DateTime   @updatedAt @map("updated_at")

      @@map("users")
}

model Team {
      id                 String                @id @default(uuid())
      user               User                  @relation(fields: [userId], references: [id])
      userId             String                @unique @map("user_id")
      name               String
      country            String?
      budget             Decimal               @default(5000000) @db.Decimal(12, 2)
      totalPlayers       Int                   @default(0) @map("total_players")
      isTeamReady        Boolean               @default(false) @map("is_team_ready")
      players            Player[]
      finances           TeamFinance[]
      transferListings   TransferListing[]
      soldTransactions   TransferTransaction[] @relation("SellerTeam")
      boughtTransactions TransferTransaction[] @relation("BuyerTeam")
      createdAt          DateTime              @default(now()) @map("created_at")
      updatedAt          DateTime              @updatedAt @map("updated_at")

      @@map("teams")
}

model Player {
      id               String                @id @default(uuid())
      team             Team                  @relation(fields: [teamId], references: [id])
      teamId           String                @map("team_id")
      firstName        String                @map("first_name")
      lastName         String                @map("last_name")
      nationality      String?
      position         String
      marketValue      Decimal               @map("market_value") @db.Decimal(12, 2)
      age              Int
      isOnTransferList Boolean               @default(false) @map("is_on_transfer_list")
      askingPrice      Decimal?              @map("asking_price") @db.Decimal(12, 2)
      transferListing  TransferListing?
      transactions     TransferTransaction[]
      createdAt        DateTime              @default(now()) @map("created_at")
      updatedAt        DateTime              @updatedAt @map("updated_at")

      @@map("players")
}

model Session {
      id        String   @id @default(uuid())
      user      User     @relation(fields: [userId], references: [id])
      userId    String   @map("user_id")
      tokenHash String   @map("token_hash")
      ipAddress String?  @map("ip_address")
      expiresAt DateTime @map("expires_at")
      isActive  Boolean  @default(true) @map("is_active")
      createdAt DateTime @default(now()) @map("created_at")

      @@map("sessions")
}

model TransferListing {
      id           String   @id @default(uuid())
      player       Player   @relation(fields: [playerId], references: [id])
      playerId     String   @unique @map("player_id")
      sellerTeam   Team     @relation(fields: [sellerTeamId], references: [id])
      sellerTeamId String   @map("seller_team_id")
      askingPrice  Decimal  @map("asking_price") @db.Decimal(12, 2)
      status       String   @default("active")
      listedAt     DateTime @default(now()) @map("listed_at")
      updatedAt    DateTime @updatedAt @map("updated_at")

      @@map("transfer_listings")
}

model TransferTransaction {
      id           String        @id @default(uuid())
      player       Player        @relation(fields: [playerId], references: [id])
      playerId     String        @map("player_id")
      sellerTeam   Team          @relation("SellerTeam", fields: [sellerTeamId], references: [id])
      sellerTeamId String        @map("seller_team_id")
      buyerTeam    Team          @relation("BuyerTeam", fields: [buyerTeamId], references: [id])
      buyerTeamId  String        @map("buyer_team_id")
      askingPrice  Decimal       @map("asking_price") @db.Decimal(12, 2)
      salePrice    Decimal       @map("sale_price") @db.Decimal(12, 2)
      commission   Decimal       @db.Decimal(12, 2)
      completedAt  DateTime      @default(now()) @map("completed_at")
      finances     TeamFinance[]

      @@map("transfer_transactions")
}

model TeamFinance {
      id                     String               @id @default(uuid())
      team                   Team                 @relation(fields: [teamId], references: [id])
      teamId                 String               @map("team_id")
      transactionType        String               @map("transaction_type")
      amount                 Decimal              @db.Decimal(12, 2)
      balanceAfter           Decimal              @map("balance_after") @db.Decimal(12, 2)
      description            String?
      referenceTransaction   TransferTransaction? @relation(fields: [referenceTransactionId], references: [id])
      referenceTransactionId String?              @map("reference_transaction_id")
      transactionDate        DateTime             @default(now()) @map("transaction_date")

      @@map("team_finances")
}

model AuditLog {
      id          String   @id @default(uuid())
      entityType  String   @map("entity_type")
      entityId    String   @map("entity_id")
      action      String
      changes     Json?
      user        User?    @relation(fields: [userId], references: [id])
      userId      String?  @map("user_id")
      performedAt DateTime @default(now()) @map("performed_at")

      @@map("audit_logs")
}
